//--------
// A SASS mixin that allows you to create columns of varying widths on top of a 12 column grid system.
// See: https://github.com/Xaxis/fluid-grid
//
// @cols              Number of columns in a row
// @mod               Width in terms of a 12 column grid ratio
// $break             Screen width at which column structures respond
// @fixed-gutter      Fixed gutter pixel width default
// @fluid-gutter      Fluid gutter percentage width default
// @gutter-type       Type of gutter to use (`fixed` or `fluid`) default
// @no-gutter         Boolean value that specifies whether a gutter is used
// @css-grid          Boolean value that enables the use of CSS Grid
// @grid-items        A list specifying grid items start/end grid line modifiers
@mixin fg-col(
  $cols: 1,
  $mod: 0,
  $break: 0,
  $fixed-gutter: 20px,
  $fluid-gutter: 2.0,
  $gutter-type: 'fluid',
  $no-gutter: false,
  $css-grid: false,
  $grid-list: false
) {


  // Default column styling
  & {
    box-sizing: border-box;
    position: relative;
    float: left;
  }
  &:before,
  &:after {
    content: " ";
    display: table;
  }
  &:after {
    clear: both;
  }
  &:first-child {
    margin-left: 0;
  }


  // Fixed width gutter ENABLED default gutter width
  @if $gutter-type == 'fixed' {
    margin-left: $fixed-gutter;
  }

  // Fixed width gutter DISABLED default gutter width
  @else if $gutter-type == 'fluid' {
    margin-left: #{$fluid-gutter + '%'};
  }


  // Equal width columns
  @if $mod == 0 {

    // Fixed width gutter ENABLED
    @if $gutter-type == 'fixed' {

      // Gutters are OFF
      @if $no-gutter == true {
        width: -webkit-calc((100% / #{$cols}));
        width: calc((100% / #{$cols}));
        margin-left: 0;
      }

      // Gutters are ON
      @else {
        width: -webkit-calc(((100% / #{$cols}) - #{$fixed-gutter}) + (#{$fixed-gutter / $cols}));
        width: calc(((100% / #{$cols}) - #{$fixed-gutter}) + (#{$fixed-gutter / $cols}));
      }
    }

    // Fluid width gutter DISABLED
    @else if $gutter-type == 'fluid' {
      $ucw: (100 / $cols);
      $cw: 0;
      @if $cols == 1 or $no-gutter == true {
        $cw: $ucw;
        margin-left: 0;
      } @else {
        $cw: $ucw - $fluid-gutter + ($fluid-gutter / $cols);
      }
      width: #{$cw + '%'};
    }
  }


  // 12 column width columns
  @else if $mod {
    $mw: 0;

    // 1/12 width
    @if $mod == 1 {
      $mw: 8.3;
    }
    // 2/12 width
    @if $mod == 2 {
      $mw: 16.6666666667;
    }
    // 3/12 width
    @if $mod == 3 {
      $mw: 25;
    }
    // 4/12
    @if $mod == 4 {
      $mw: 33.3333;
    }
    // 5/12
    @if $mod == 5 {
      $mw: 41.66;
    }
    // 6/12
    @if $mod == 6 {
      $mw: 50;
    }
    // 7/12
    @if $mod == 7 {
      $mw: 58.33;
    }
    // 8/12
    @if $mod == 8 {
      $mw: 66.6666;
    }
    // 9/12
    @if $mod == 9 {
      $mw: 75;
    }
    // 10/12
    @if $mod == 10 {
      $mw: 83.3333333333;
    }
    // 11/12
    @if $mod == 11 {
      $mw: 91.7;
    }
    // 12/12
    @if $mod == 12 {
      $mw: 100;
    }

    // Fixed width gutter ENABLED
    @if $gutter-type == 'fixed' {

      // Gutters are OFF
      @if $no-gutter == true or $mod == 12 {
        width: -webkit-calc(#{$mw + '%'});
        width: calc(#{$mw + '%'});
        margin-left: 0;
      }

      // Gutters are ON
      @else {
        width: -webkit-calc((#{$mw + '%'} - #{$fixed-gutter}) + (#{$fixed-gutter / $cols}));
        width: calc((#{$mw + '%'} - #{$fixed-gutter}) + (#{$fixed-gutter / $cols}));
      }
    }

    // Fluid width gutter enabled
    @else if $gutter-type == 'fluid' {
      $ucw: $mw / 100;
      $cw: 0;
      @if $mod == 12 or $no-gutter == true {
        $cw: $ucw * 100;
        margin-left: 0;
      } @else {
        $cw: ($ucw * 100) - $fluid-gutter + ($fluid-gutter / $cols);
      }
      width: #{$cw + '%'};
    }
  }


  // CSS Grid
  @if $css-grid == true {
    & {
      float: none;
      margin-left: 0 !important;
      width: auto !important;
      display: grid;
      grid-template-columns: repeat(#{$cols}, 1fr);
    }
    &:before,
    &:after {
      display: none;
    }
    @if $no-gutter == false {
      grid-column-gap: $fixed-gutter;
      grid-row-gap: $fixed-gutter;
    }
    @if type-of($grid-list) == 'map' {
      @each $elm-number, $item in $grid-list {
        $start: nth($item, 1);
        $end: nth($item, 2);
        & > :nth-child(#{$elm-number}) {
          grid-column-start: $start;
          grid-column-end: $end;
        }
      }
    }
  }


  // Add breakpoint when active
  @if $break > 0 {
    &, &:first-child {
      @media only all and (max-width: $break) {
        margin-left: 0;
        width: 100%;
        display: block !important;
        @if $css-grid {
          & > * {
            @content;
          }
        } @else {
          @content;
        }
      }
    }
  }
}




//--------
// Fluid-grid base classes (12 grid fractions)
// See: https://github.com/Xaxis/fluid-grid
$fg-class-prefix: "fg-";
$fg-fixed-gutter: 20px;
$fg-fluid-gutter: 2.0;
$fg-break-default: 1740px;
@mixin fg-col-class($col-count, $col-grid) {
  &:not(#{"."}#{$fg-class-prefix}no-gutter) {
    @include fg-col($cols:$col-count, $mod:$col-grid, $no-gutter: false);
  }
  &#{"."}#{$fg-class-prefix}no-gutter {
    @include fg-col($cols:$col-count, $mod:$col-grid, $no-gutter: true);
  }
}
@for $i from 1 through 12 {

  // Generate column classes
  #{"."}#{$fg-class-prefix}col:first-child:nth-last-child(#{$i}),
  #{"."}#{$fg-class-prefix}col:first-child:nth-last-child(#{$i}) ~ #{"."}#{$fg-class-prefix}col {

    // Equal width column sizes
    &:not(#{"."}#{$fg-class-prefix}no-gutter) {
      @include fg-col($cols:$i);
    }
    &#{"."}#{$fg-class-prefix}no-gutter {
      @include fg-col($cols:$i, $no-gutter: true);
    }

    // Grid column sizes
    $col-selector: "&" + "." + $fg-class-prefix + "col-";
    #{$col-selector}1 {
      @include fg-col-class($i, 1);
    }
    #{$col-selector}2 {
      @include fg-col-class($i, 2);
    }
    #{$col-selector}3 {
      @include fg-col-class($i, 3);
    }
    #{$col-selector}4 {
      @include fg-col-class($i, 4);
    }
    #{$col-selector}5 {
      @include fg-col-class($i, 5);
    }
    #{$col-selector}6 {
      @include fg-col-class($i, 6);
    }
    #{$col-selector}7 {
      @include fg-col-class($i, 7);
    }
    #{$col-selector}8 {
      @include fg-col-class($i, 8);
    }
    #{$col-selector}9 {
      @include fg-col-class($i, 9);
    }
    #{$col-selector}10 {
      @include fg-col-class($i, 10);
    }
    #{$col-selector}11 {
      @include fg-col-class($i, 11);
    }
    #{$col-selector}12 {
      @include fg-col-class($i, 12);
    }
  }

  // Breakpoint classes (based on default break width)
  #{"."}#{$fg-class-prefix}break-#{$i} {
    $bw: ($i / 12) * $fg-break-default;
    @media only all and (max-width: $bw) {
      margin-left: 0 !important;
      width: 100% !important;
      display: block !important;
    }
  }

  // Grid classes
  #{"."}#{$fg-class-prefix}grid-#{$i} {
    &:not(#{"."}#{$fg-class-prefix}no-gutter) {
      @include fg-col($cols:$i, $css-grid: true);
    }
    &#{"."}#{$fg-class-prefix}no-gutter {
      @include fg-col($cols:$i, $css-grid: true, $no-gutter: true);
    }
  }
  @for $n from 1 through 12 {
    #{"."}#{$fg-class-prefix}item-#{$n}-#{$i} {
      grid-column-start: $n;
      grid-column-end: $i;
    }
  }
  #{"."}#{$fg-class-prefix}break-#{$i} {
    & {
      $bw: ($i / 12) * $fg-break-default;
      @media only all and (max-width: $bw) {
        margin-left: 0;
        width: 100%;
        display: block;
      }
    }
  }
}